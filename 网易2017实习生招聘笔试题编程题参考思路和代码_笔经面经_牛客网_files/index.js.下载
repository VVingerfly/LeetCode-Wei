define("nowcoder/1.2.751/javascripts/component/cmt/action",["nc","../../action/contest","../../util/ajax","cpn","../../core/siteConfig"],function(a,b,c){function d(a){l.getCommentByPageV2({query:{pageSize:a.pageSize||10,page:a.page||1,order:a.order||1,entityId:a.entityId,entityType:a.entityType},call:a.call,error:a.error,always:a.always})}function e(a){l.getCommentPageNum({query:{pageSize:a.pageSize||10,order:a.order||1,entityId:a.entityId,entityType:a.entityType,commentId:a.commentId},call:a.call,error:a.error,always:a.always})}function f(a){l.comment({body:{entityType:a.entityType,entityId:a.entityId,commentContent:a.content,toUserId:a.toUserId,toCommentId:a.toCommentId},call:a.call,error:a.error,always:a.always})}function g(a){l.delComment({body:{id:a.id},call:a.call,error:a.error,always:a.always})}function h(a){l[a.action]({body:{id:a.id,type:a.type},call:a.call,error:a.error,always:a.always})}var i=a("nc"),j=i.Base,k=i.Clazz,l=(i.Component,a("../../action/contest")),m=c.exports=k.create();j.extend(m,{getCmts:d,getCmtPageNum:e,addCmt:f,delCmt:g,like:h})});
define("nowcoder/1.2.751/javascripts/component/cmt/cpn/reply",["nc"],function(a,b,c){function d(){var a=this,b=a.getEl(),c=a.ipt;c.on("focus",function(){b.addClass("reply-focus")}).on("blur",function(){b.removeClass("reply-focus")}),window.setTimeout(function(){c.outerWidth(b.width())},0),l.txtAutoHeight({el:c})}function e(a){var b=this,c=b.ipt;return 0===arguments.length?i.trim(c.val()):void c.val(i.trim(a))}function f(){var a=this;a.ipt.focus()}function g(a){return{placeholder:a.placeholder||"请输入你的观点"}}var h=a("nc"),i=h.$,j=(h.Base,h.Clazz),k=h.Component,l=h.Dom,m=c.exports=j.create();j.mix(m,k,{_template:['<div class="reply-editbox clearfix" style="margin-top:10px;">','<div class="reply-write">','<textarea placeholder="#{placeholder}" class="reply-input reply-input-textarea js-ipt"></textarea>',"</div>",'<a class="btn btn-primary reply-btn js-reply" href="javascript:void(0);">回复</a>',"</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.getEl();a.ipt=b.find(".js-ipt"),a.initInput()}},{name:"click a.js-reply",handler:function(a){var b=this,c=i(a.currentTarget),d=(b.rawConfig,b.val());return d?void b.fire("goAddCmt",d,c):b.focus()}}]},{initInput:d,val:e,focus:f,_getData:g})});
define("nowcoder/1.2.751/javascripts/component/cmt/item/item",["nc","cpn","../../../action/contest","../../../util/ajax","../../../core/siteConfig","../action"],function(a,b,c){function d(a,b){return s.extend({},b,{id:a.id,item:a,data:{id:a.id,authorId:a.authorId,authorName:a.authorName,authorAvatar:a.headImg||A.avatar.small,authorLevel:a.honorLevel,toUserId:a.toUserId,toUserName:a.toUserName,toUserHonorLevel:a.toUserHonorLevel,toCommentId:a.toCommentId,floor:b.index+1,content:a.content,createTime:a.createTime,commentCount:a.commentCnt,isLiked:a.isLiked,likeCount:a.likes}})}function e(){var a=this,b=(a.getEl(),a.getActionEl());if(0!==b.length&&(a.isAdmin()||a.isSelf())){var c=r('<a href="javascript:void(0);" class="click-del js-cmt-action" data-action="del">删除</a>');b.append(c)}}function f(a){var b=this,c=b.rawConfig,d=c.data,e=d.isLiked;w.mark(a)||B.like({action:e?"unlike":"like",id:c.id,type:A.type.comment,call:function(b){d.isLiked=!e,d.likeCount=b.count,a.text((e?"赞":"已赞")+"("+b.count+")")},error:function(a){x.alert(a.msg)},always:function(){w.clear(a)}})}function g(){var a=this,b=a.rawConfig,c=a.getEl();x.confirm("确定删除评论？",function(){B.delCmt({id:b.id,call:function(b){c.slideUp(150,function(){a.subCmtList&&a.subCmtList.destroy(),a.fire("delCmt",b),a.destroy(),x.tips("操作成功")})},error:function(a){x.alert(a.msg)}})})}function h(a){var b=this,c=b.getSubCmtEl();return 0===c.length||w.mark(a)?void 0:b.subCmtList?void c.slideUp(150,function(){c.hide(),b.subCmtList.destroy(),b.subCmtList=null,c.html(""),w.clear(a)}):void b.openSubCmt()}function i(){var b=this,c=b.rawConfig,d=c.data,e=b.getSubCmtEl(),f=r(b.getActionEl().find("a.js-cmt-action")[0]);0!==e.length&&a.async("../index",function(a){e.show(),b.subCmtList=new a({renderTo:e,type:"sub",cmtClazz:b.constructor.subCmtClazz,isAdmin:c.isAdmin,isSubCmt:!0,needReply:!0,entityId:c.id,entityType:A.type.comment,currentUid:c.currentUid,userId:d.authorId,pageSize:10,page:1,order:1,extHeight:c.extHeight,listeners:{listDataChange:function(a){f.text("回复("+(a.totalCount||0)+")")}}}),w.clear(f)})}function j(){}function k(){}function l(){var a=this,b=a.rawConfig,c=s.id(b.currentUid);return c&&c===s.id((b.data||{}).authorId)}function m(){var a=this,b=a.rawConfig;return!!b.isAdmin}function n(a){var b=new Date(a),c=new Date,d=b.getFullYear()===c.getFullYear()&&b.getMonth()===c.getMonth()&&b.getDate()===c.getDate();return d?"今天 "+u.form(b,"HH:mm:ss"):u.form(b,"yyyy-MM-dd HH:mm:ss")}function o(a){var b=this,c=a.data;return s.extend({},c,{id:a.id,createTime:b.formTime(c.isEdited?c.updateTime:c.createTime),likeTxt:c.isLiked?"已赞":"赞",likeType:c.isLiked?"unlike":"like"},b.getExtData&&b.getExtData())}var p=a("nc"),q=a("cpn"),r=p.$,s=p.Base,t=p.Component,u=p.Time,v=p.Clazz,w=(p.Dom,p.Limit),x=q.Popup,y=q.PopupImage,z=c.exports=v.create(),A=(a("../../../action/contest"),a("../../../core/siteConfig")),B=a("../action");v.mix(z,t,{_template:"<div></div>",_listTemplate:'<div class="js-list"></div>',_noneTemplate:"没有数据",listeners:[{name:"render",type:"custom",handler:function(){{var a=this;a.rawConfig}a.initExtAction()}},{name:"click .js-cmt-action",handler:function(a){a.stopPropagation();var b=this,c=r(a.currentTarget),d=r.trim(c.attr("data-action"));b[d+"Action"]&&b[d+"Action"](c)}},{name:"click img",handler:function(a){var b=r(a.currentTarget),c=r.trim(b.attr("src"));c&&y.show(c)}}],initConf:d},{initExtAction:e,likeAction:f,delAction:g,replyAction:h,openSubCmt:i,getSubCmtEl:j,getActionEl:k,isSelf:l,isAdmin:m,formTime:n,_getData:o})});
define("nowcoder/1.2.751/javascripts/component/cmt/item/bbs",["nc","cpn","./item","../../../action/contest","../../../util/ajax","../../../core/siteConfig","../action"],function(a,b,c){function d(){var a=this,b=a.getEl();return b.find(".js-action")}function e(){var a=this,b=a.getEl();return b.find(".js-sub-cmt-list")}var f=a("nc"),g=(a("cpn"),f.$,f.Base,f.Clazz),h=a("./item"),i=c.exports=g.create();g.mix(i,h,{_template:['<li class="answer-list-item clearfix js-copy-mark" data-mark-info="作者：#{authorName}">','<div class="answer-content clearfix">','<a class="answer-head js-nc-card" data-card-uid="#{authorId}" href="/profile/#{authorId}">','<img alt="#{authorName}头像" src="#{authorAvatar}">',"</a>",'<div class="answer-detail">',"<p>",'<a title="#{authorName}" href="/profile/#{authorId}" data-card-uid="#{authorId}" class="js-copy-tip js-nc-card answer-name level-color-#{authorLevel}">#{authorName}</a>','<span class="post-floor">#{floor}#</span>',"</p>",'<div class="answer-brief">#{content}</div>','<div class="answer-legend js-action">','<span class="answer-time">发表于 #{createTime}</span>','<a href="javascript:void(0);" class="js-cmt-action" data-action="reply">回复(#{commentCount})</a>','<a href="javascript:void(0);" class="js-cmt-action" data-action="like">#{likeTxt}(#{likeCount})</a>',"</div>",'<div class="reply-box js-sub-cmt-list" style="display:none;"></div>',"</div>","</div>","</li>"].join(""),_listTemplate:'<ul class="answer-list discuss-topic-answers js-list"></ul>',_noneTemplate:['<div class="blank-box">','<div class="blank-img"><img src="//static.nowcoder.com/images/sofa.png"></div>',"<p>帖子还没人回复，快来抢沙发！</p>","</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){}}]},{getActionEl:d,getSubCmtEl:e})});
define("nowcoder/1.2.751/javascripts/component/cmt/item/sub",["nc","cpn","./item","../../../action/contest","../../../util/ajax","../../../core/siteConfig","../action","../cpn/reply"],function(a,b,c){function d(){}function e(a){var b=this,c=b.rawConfig,d=c.data,e=b.getEl(),f=e.find(".js-sub-reply");if(!l.mark(a)){if(b.replyCpn)return f.slideUp(150,function(){f.hide(),b.replyCpn.destroy(),b.replyCpn=null,f.html(""),l.clear(a)});b.replyCpn=new n({renderTo:f,placeholder:"回复"+d.authorName,listeners:{render:function(){var a=this.getEl();a.prepend('<div class="toparrow"></div>')},goAddCmt:function(a,c){b.fire("goAddCmt",{content:a,toUserId:d.authorId,toCommentId:d.id},c)}}}),f.slideDown(150,function(){l.clear(a),b.replyCpn.focus()})}}function f(){var a=this,b=a.getEl();return b.find(".js-sub-action")}function g(){var a=this,b=a.rawConfig,c=b.data,d=c.toUserId&&i.id(c.toCommentId)!==i.id(b.parentId)?k.execTpl(' 回复 <a href="/profile/#{uid}" data-card-uid="#{uid}" class="js-nc-card #{cls}">#{userName}</a>：',{uid:c.toUserId,userName:c.toUserName,cls:i.id(c.toUserHonorLevel)?"level-color-"+c.toUserHonorLevel:""}):"：";return{authorExt:d}}var h=a("nc"),i=(a("cpn"),h.$,h.Base),j=h.Clazz,k=h.Str,l=h.Limit,m=a("./item"),n=a("../cpn/reply"),o=c.exports=j.create();j.mix(o,m,{_template:['<li class="ui-subcmt-item js-copy-mark" data-mark-info="作者：#{authorName}">','<div class="reply-main clearfix">','<div class="reply-person" style="margin-right:5px;"><a href="/profile/#{authorId}" data-card-uid="#{authorId}" class="js-copy-tip js-nc-card level-color-#{authorLevel}">#{authorName}</a>#{authorExt}</div>','<div class="reply-content">#{content}</div>',"</div>",'<div class="answer-legend reply-info js-sub-action">','<span class="reply-time">#{createTime}</span>','<a href="javascript:void(0);" class="reply-answer js-cmt-action" data-action="reply">回复</a>','<a href="javascript:void(0);" class="reply-like js-cmt-action" data-action="like">#{likeTxt}(#{likeCount})</a>',"</div>",'<div class="js-sub-reply" style="display:none;"></div>',"</li>"].join(""),_listTemplate:'<ul class="reply-list js-list"></ul>',_noneTemplate:" "},{initialize:d,replyAction:e,getActionEl:f,getExtData:g})});
define("nowcoder/1.2.751/javascripts/component/cmt/index",["nc","cpn","../../core/siteConfig"],function(a,b,c){function d(a){var b=this;a.type=a.type||"bbs",b.totalCount=-1,b.page=a.page,b.pageSize=a.pageSize||20,b.cmtList=[]}function e(b){function c(a,c,d){t=a,u=c,v=d,b&&b()}var d=["./item/bbs","./item/sub","./action"],e=[];z.forEach(d,function(b,f){a.async(b,function(a){e[f]=a,e.length===d.length&&c.apply(null,e)})})}function f(){var a=this,b=a.contentEl;B.recycle(b,!1);var c=a.cmtClazz._listTemplate||"";b.html(c).show(),a.listEl=b.find(".js-list")}function g(){var b=this,c=b.rawConfig,d=b.replyEl;c.needReply&&a.async("./cpn/reply",function(a){var e=new a({renderTo:d,listeners:{goAddCmt:function(a,d){if(!C.mark(d)){var f=z.id(c.entityType)===z.id(H.type.comment)?c.entityId:null;b.createCmt({content:a,toUserId:c.userId||0,toCommentId:f,call:function(a){var c=z.id(a.data);c&&b.scrollToId(c),!c&&b.scrollToTop(),e.val("")},always:function(){C.clear(d)}})}}}});d.show()})}function h(a,b){var c=this;c.getListData(a,function(a,d){c.renderList(a,d),b&&b(a,d)})}function i(a,b){var c=this,d=(c.rawConfig,b.comments);c.cmtList.length=0,c.showTips(!1),c.initTheme(),0===d.length&&c.renderNone(),z.forEach(d,function(a,b){c.renderCmtItem(a,b)}),c.renderPager(a,b.totalPage),c.fire("listDataChange",{totalCount:c.totalCount})}function j(a,b){var c=this,d=c.rawConfig,e=(c.getCmtType(),c.cmtClazz),f=e.initConf(a,{renderTo:c.listEl,parentId:d.entityId,isAdmin:d.isAdmin,currentUid:d.currentUid,index:b+(c.page-1)*c.pageSize,extHeight:d.extHeight,listeners:{goAddCmt:function(a,b){a&&(C.mark(b)||c.createCmt(z.extend(a,{always:function(){C.clear(b)}})))},delCmt:function(){c.totalCount--,c.renderPage(c.page)}}}),a=new e(f);if(c.cmtList.push(a),d.autoOpenSubCmt&&0!==f.data.commentCount){var g=y(a.getActionEl().find("a.js-cmt-action")[0]);if(C.mark(g))return;a.openSubCmt(g)}}function k(){var a=this,b=a.rawConfig,c=(a.getEl(),b.noneTips||a.cmtClazz._noneTemplate||"没有数据");a.contentEl.html(c)}function l(a,b){var c=this,d=(c.getEl(),c.pageEl);B.recycle(d,!1),d[b>1?"show":"hide"](),new F({renderTo:d,renderBy:"html",current:a,total:b,pageChange:function(a){c.renderPage(a,function(){c.scrollToTop()})}})}function m(a,b){{var c=this,d=c.rawConfig;c.getEl()}a=a||d.page||1,-1===a&&c.totalCount>=0&&(a=E.page(c.totalCount,c.pageSize)),v.getCmts({pageSize:c.pageSize,page:Math.max(a,1),order:d.order,entityId:d.entityId,entityType:d.entityType,call:function(d){var e=d.data;return-1===a||0!==e.totalCnt&&0===e.comments.length?c.renderPage(e.totalPage):(c.totalCount=e.totalCnt,c.page=a,c.pageSize=e.pageSize,void b(a,e))},error:function(a){c.showTips(a.msg)}})}function n(a){function b(){v.addCmt(z.extend({},a,{content:e,entityId:d.entityId,entityType:d.entityType,call:function(b){c.page;c.totalCount++,c.renderPage(-1,function(){!c.isSubCmt()&&z.id(b.data)?c.scrollToId(b.data):c.scrollToTop()}),!c.isSubCmt()&&G.tips(d.replySuccTips||"你的回复已提交"),a.call&&a.call(b)},error:function(b){G.alert(b.msg),a.error&&a.error(b)}}))}var c=this,d=c.rawConfig,e=a.content,f=e.replace(/<.*?>/gi,""),g=/<img.+>/gi.test(e);g||f?f.length<5?G.confirm("灌水的话可能会被管理员删除的，确定现在提交吗",function(){b()},function(){a.always&&a.always()}):b():(G.alert("内容不能为空"),a.always&&a.always())}function o(){var a=this,b=a.rawConfig;return b.isSubCmt||"sub"===b.type}function p(){var a=this,b=a.rawConfig;return b.type||"bbs"}function q(a){var b=this,c=b.rawConfig,d=c.renderTo;D.scrollToEl({el:d,scrollEl:D.getScrollParent(d),animation:!!a,ext:+c.extHeight||0})}function r(a,b,c){var d=this,e=d.rawConfig,f=(d.cmtList,z.find(d.cmtList,function(b){return z.id(b.rawConfig.id)===z.id(a)}));if(f){var g=f.getEl();D.scrollToEl({el:g,scrollEl:D.getScrollParent(g),animation:!!b,ext:+e.extHeight||0}),c&&D.highLight({el:g})}}function s(a){var b=this,c=(b.getEl(),b.tipsEl);return a&&y.trim(a)?void c.html('<div style="padding:20px 0;text-align:center;">'+a+"</div>").show():c.hide().html("")}var t,u,v,w=a("nc"),x=a("cpn"),y=w.$,z=w.Base,A=w.Clazz,B=w.Component,C=w.Limit,D=w.Dom,E=w.Num,F=x.Pager,G=x.Popup,H=a("../../core/siteConfig"),I=c.exports=A.create();A.mix(I,B,{_template:["<div>",'<div class="js-tips"></div>','<div class="js-content" style="display:none;"></div>','<div class="js-pager-box" style="display:none;"></div>','<div class="js-reply-box" style="display:none;"></div>',"</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.getEl(),c=a.rawConfig;a.contentEl=b.find(".js-content"),a.replyEl=b.find(".js-reply-box"),a.tipsEl=b.find(".js-tips"),a.pageEl=b.find(".js-pager-box"),a.showTips("加载中..."),a.initPlugin(function(){if(a.cmtClazz=c.cmtClazz||{bbs:t,sub:u}[c.type],!a.cmtClazz)return a.showTips("缺少评论模板");var b=z.id(c.commentId);b?v.getCmtPageNum({pageSize:a.pageSize,order:c.order,entityId:c.entityId,entityType:c.entityType,commentId:b,call:function(b){a.page=+b.data},always:function(){a.renderPage(a.page,function(){a.scrollToId(b,!0,!0)})}}):a.renderPage(a.page),a.initReply()})}}]},{initialize:d,initPlugin:e,initTheme:f,initReply:g,renderPage:h,renderList:i,renderCmtItem:j,renderNone:k,renderPager:l,getListData:m,createCmt:n,isSubCmt:o,getCmtType:p,scrollToTop:q,scrollToId:r,showTips:s})});